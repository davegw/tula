(function(){$(function(){return CMS.init()}),window.CMS={current_path:window.location.pathname,code_mirror_instances:[],init:function(){return CMS.slugify(),CMS.wysiwyg(),CMS.codemirror(),CMS.sortable_list(),CMS.timepicker(),CMS.page_blocks(),CMS.mirrors(),CMS.page_update_preview(),CMS.page_update_publish(),CMS.categories(),CMS.uploader()}},window.CMS.slugify=function(){var e;return e=function(e){var t,n,i,r,o,a,u;for(e=e.replace(/^\s+|\s+$/g,""),i="\xc0\xc1\xc4\xc2\xc3\xc8\xc9\xcb\xca\xcc\xcd\xcf\xce\xd2\xd3\xd6\xd4\xd5\xd9\xda\xdc\xdb\xe0\xe1\xe4\xe2\xe3\xe8\xe9\xeb\xea\xec\xed\xef\xee\xf2\xf3\xf6\xf4\xf5\xf9\xfa\xfc\xfb\xd1\xf1\xc7\xe7",u="aaaaaeeeeiiiiooooouuuuaaaaaeeeeiiiiooooouuuunncc",r=o=0,a=i.length-1;a>=0?a>=o:o>=a;r=a>=0?++o:--o)e=e.replace(new RegExp(i[r],"g"),u[r]);return n=new RegExp("[\xb7/,:;_]","g"),e=e.replace(n,"-"),t=new RegExp("[^a-zA-Z0-9 -]","g"),e=e.replace(t,"").replace(/\s+/g,"-").toLowerCase()},$("input[data-slugify=true]").bind("keyup.cms",function(){return $("input[data-slug=true]").val(e($(this).val()))})},window.CMS.wysiwyg=function(){return $("textarea[data-rich-text]").each(function(e,t){return $(t).wysihtml5({html:!0,color:!1,stylesheets:[]})})},window.CMS.codemirror=function(){return $("textarea[data-cm-mode]").each(function(e,t){var n;return n=CodeMirror.fromTextArea(t,{mode:$(t).data("cm-mode"),lineWrapping:!0,autoCloseTags:!0,lineNumbers:!0}),CMS.code_mirror_instances.push(n)}),$('a[data-toggle="tab"]').on("shown",function(){var e,t,n,i,r;for(i=CMS.code_mirror_instances,r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push(e.refresh());return r})},window.CMS.sortable_list=function(){return $(".sortable").sortable({handle:"div.dragger",axis:"y",update:function(){return $.post(CMS.current_path+"/reorder","_method=put&"+$(this).sortable("serialize"))}})},window.CMS.timepicker=function(){return $("input[type=text][data-datetime]").datetimepicker({format:"yyyy-mm-dd hh:ii",minView:"day",autoclose:!0}),$("input[type=text][data-date]").datetimepicker({format:"yyyy-mm-dd",minView:"minute",autoclose:!0})},window.CMS.page_blocks=function(){return $("select#page_layout_id").bind("change.cms",function(){return $.ajax({url:$(this).data("url"),data:{layout_id:$(this).val()},complete:function(){return CMS.wysiwyg(),CMS.timepicker()}})})},window.CMS.mirrors=function(){return $("#mirrors select").change(function(){return window.location=$(this).val()})},window.CMS.page_update_preview=function(){return $("input[name=commit]").click(function(){return $(this).parents("form").attr("target","")}),$("input[name=preview]").click(function(){return $(this).parents("form").attr("target","_blank")})},window.CMS.page_update_publish=function(){var e;return e=$("#form-save"),$("input",e).prop("checked",$("input#page_is_published").is(":checked")),$("button",e).html($("input[name=commit]").val()),$("input",e).click(function(){return $("input#page_is_published").prop("checked",$(this).is(":checked"))}),$("input#page_is_published").click(function(){return $("input",e).prop("checked",$(this).is(":checked"))}),$("button",e).click(function(){return $("input[name=commit]").click()})},window.CMS.categories=function(){return $("a",".categories-widget .action-links").click(function(e){return e.preventDefault(),$(".categories.read",".categories-widget").toggle(),$(".categories.editable",".categories-widget").toggle(),$(".edit",".categories-widget").toggle(),$(".done",".categories-widget").toggle()})},window.CMS.uploader=function(){var e,t,n;return e=$(".file-uploader form"),t=$("iframe#file-upload-frame"),$("input[type=file]",e).change(function(){return e.submit()}),t.load(function(){return n()}),n=function(){var e,n,i,r,o,a;return i=t[0],e=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:i.document,e.body.innerHTML?(a=e.body.innerHTML,o=a.match(/\{(.|\n)*\}/)[0],r=$.parseJSON(o),n=$($("<div/>").html(r.view).text()).hide(),$(".uploaded-files").prepend(n),n.map(function(){return $(this).fadeIn()})):void 0}}}).call(this);